---
title: 版本管理
date: 2024-04-23 18:12:00
permalink: /cn/Zadig v4.0/api/delivery/
---

## 列出版本

**请求**

```
GET /openapi/delivery/releases?projectKey=<projectKey>&pageNum=<pageNum>&pageSize=<pageSize>
```

**Query 参数说明**

| 参数名       | 类型   | 描述     | 必填 |
| ------------ | ------ | -------- | ---- |
| `projectKey` | string | 项目标识 | 是   |
| `pageNum`    | int    | 指定页数 | 是   |
| `pageSize`   | int    | 每页数量 | 是   |


**成功返回说明**

| 参数名  | 类型                                            | 描述     |
| ------- | ----------------------------------------------- | -------- |
| `list`  | [][DeliveryVersionInfo](#delivery-version-info) | 版本列表 |
| `total` | int                                             | 版本总数 |

<h4 id="delivery-version-info">DeliveryVersionInfo 参数说明</h4>

| 参数名         | 类型     | 说明                                      |
| -------------- | -------- | ----------------------------------------- |
| `id`           | string   | 版本ID                                    |
| `version_name` | string   | 版本名称                                  |
| `source`       | string   | 来源，manual、from_env、from_version      |
| `type`         | string   | 类型，K8SYaml 或 HelmChart                |
| `status`       | string   | 状态，success、failed、creating、retrying |
| `labels`       | []string | 标签                                      |
| `description`  | string   | 描述                                      |
| `created_by`   | string   | 创建人                                    |
| `created_time` | int64    | 创建时间                                  |

**成功返回示例**

::: details
```json
{
    "list": [
        {
            "id": "66287b110b8b8a631910f5ae",
            "version_name": "v13",
            "type": "K8SYaml",
            "source": "manual",
            "status": "success",
            "labels": [],
            "description": "labore id amet",
            "progress": null,
            "created_by": "patrick",
            "create_time": 1713928977
        },
        {
            "id": "662751047ac26dae6a3a1472",
            "version_name": "v12",
            "type": "K8SYaml",
            "source": "from_env",
            "status": "failed",
            "labels": [],
            "description": "labore id amet",
            "progress": null,
            "created_by": "patrick",
            "create_time": 1713852676
        }
    ],
    "total": 12
}
```
:::

## 获取版本详情

**请求**

```
GET /openapi/delivery/releases/:id
```

**路径参数说明**

| 参数名 | 类型   | 描述   | 必填 |
| ------ | ------ | ------ | ---- |
| `id`   | string | 版本ID | 是   |


**成功返回说明**

| 参数名              | 类型                                                  | 说明                                                   |
| ------------------- | ----------------------------------------------------- | ------------------------------------------------------ |
| `id`                | string                                                | 版本ID                                                 |
| `version_name`      | string                                                | 版本名称                                               |
| `project_key`       | string                                                | 项目标识                                               |
| `source`            | string                                                | 来源，manual、from_env、from_version                   |
| `env_name`          | string                                                | 环境名称，source 为 from_env/from_version 时有效       |
| `production`        | bool                                                  | 是否为生产环境，source 为 from_env/from_version 时有效 |
| `type`              | string                                                | 类型，K8SYaml 或 HelmChart                             |
| `status`            | string                                                | 状态，success、failed、creating、retrying              |
| `error`             | string                                                | 错误信息                                               |
| `labels`            | []string                                              | 标签                                                   |
| `description`       | string                                                | 描述                                                   |
| `image_registry_id` | string                                                | 镜像仓库 ID                                            |
| `chart_repo_name`   | string                                                | Chart 仓库名称，type 为 HelmChart 时有效               |
| `services`          | [][DeliveryVersionService](#delivery-version-service) | 服务列表                                               |
| `created_by`        | string                                                | 创建人                                                 |
| `created_time`      | int64                                                 | 创建时间                                               |

<h4 id="delivery-version-service">DeliveryVersionService 参数说明</h4>

| 参数名          | 类型                                            | 说明           |
| --------------- | ----------------------------------------------- | -------------- |
| `service_name`  | string                                          | 服务名称       |
| `chart_name`    | string                                          | Chart 名称     |
| `chart_version` | string                                          | Chart 版本     |
| `chart_status`  | string                                          | Chart 推送状态 |
| `yaml_content`  | string                                          | Yaml 内容      |
| `images`        | [DeliveryVersionImage](#delivery-version-image) | 镜像列表       |
| `error`         | string                                          | 推送错误信息   |

<h4 id="delivery-version-image">DeliveryVersionImage 参数说明</h4>

| 参数名             | 类型   | 说明         |
| ------------------ | ------ | ------------ |
| `container_name`   | string | 容器名称     |
| `image_name`       | string | 镜像名称     |
| `source_image`     | string | 源镜像地址   |
| `source_image_tag` | string | 源镜像 tag   |
| `target_image`     | string | 目标镜像地址 |
| `target_image_tag` | string | 目标镜像 tag |
| `push_image`       | bool   | 是否推送镜像 |
| `status`           | string | 推送状态     |
| `error`            | string | 推送错误信息 |

**成功返回示例**

K8s YAML 项目

::: details
```json
{
    "version_info": {
        "id": "66287b110b8b8a631910f5ae",
        "version_name": "v13",
        "type": "K8SYaml",
        "status": "success",
        "labels": [
            "cupidatat ullamco anim eiusmod"
        ],
        "description": "labore id amet",
        "progress": {
            "success_count": 2,
            "total_count": 2,
            "upload_status": "success",
            "error": ""
        },
        "created_by": "patrick",
        "create_time": 1713928977
    },
    "deploy_infos": [
        {
            "id": "66287b110b8b8a631910f5af",
            "service_name": "service1",
            "service_module": "service1",
            "image": "koderover.tencentcloudcr.com/test/service1:20240419133934-5-main",
            "image_name": "service1",
            "registry_id": "62ce6231e0281143de477e60",
            "create_time": 1713928977
        },
        {
            "id": "66287b110b8b8a631910f5b0",
            "service_name": "service2",
            "service_module": "service2",
            "image": "koderover.tencentcloudcr.com/test/service2:20240419133934-5-main",
            "image_name": "service2",
            "registry_id": "62ce6231e0281143de477e60",
            "create_time": 1713928977
        }
    ],
    "distribute_infos": []
}
```
:::

Helm Chart 项目

::: details
```json
{
    "version_info": {
        "id": "66287c000b8b8a631910f5b8",
        "version_name": "v4",
        "type": "HelmChart",
        "status": "success",
        "labels": [
            "cupidatat ullamco anim eiusmod"
        ],
        "description": "labore id amet",
        "progress": {
            "success_count": 2,
            "total_count": 2,
            "upload_status": "success",
            "error": ""
        },
        "created_by": "patrick",
        "create_time": 1713929216
    },
    "deploy_infos": [],
    "distribute_infos": [
        {
            "id": "66287c080b8b8a631910f5bd",
            "service_name": "service2",
            "distribute_type": "chart",
            "chart_name": "service2",
            "chart_repo_name": "test",
            "chart_version": "1.76",
            "service_module": "",
            "image": "",
            "image_name": "",
            "namespace": "",
            "create_time": 1713929224,
            "sub_distributes": [
                {
                    "id": "66287c080b8b8a631910f5bc",
                    "service_name": "service2",
                    "distribute_type": "image",
                    "chart_name": "",
                    "chart_repo_name": "",
                    "chart_version": "",
                    "service_module": "service2",
                    "image": "koderover.tencentcloudcr.com/test/service2:20240419133934-5-main",
                    "image_name": "service2",
                    "namespace": "test",
                    "create_time": 1713929224,
                    "sub_distributes": []
                }
            ]
        },
        {
            "id": "66287c0f0b8b8a631910f5c0",
            "service_name": "service1",
            "distribute_type": "chart",
            "chart_name": "service1",
            "chart_repo_name": "test",
            "chart_version": "1.76",
            "service_module": "",
            "image": "",
            "image_name": "",
            "namespace": "",
            "create_time": 1713929231,
            "sub_distributes": [
                {
                    "id": "66287c0f0b8b8a631910f5bf",
                    "service_name": "service1",
                    "distribute_type": "image",
                    "chart_name": "",
                    "chart_repo_name": "",
                    "chart_version": "",
                    "service_module": "service1",
                    "image": "koderover.tencentcloudcr.com/test/service1:20240419133934-5-main",
                    "image_name": "service1",
                    "namespace": "test",
                    "create_time": 1713929231,
                    "sub_distributes": []
                }
            ]
        }
    ]
}
```
:::

## 删除版本

**请求**

```
DELETE /openapi/delivery/releases/:id?projectKey=<projectKey>
```

**路径参数说明**

| 参数名 | 类型   | 描述   | 必填 |
| ------ | ------ | ------ | ---- |
| `id`   | string | 版本ID | 是   |

**Query 参数说明**

| 参数名       | 类型   | 描述     | 必填 |
| ------------ | ------ | -------- | ---- |
| `projectKey` | string | 项目标识 | 是   |

**成功返回示例**

```json
{
  "message": "success"
}
```

## K8s YAML 项目创建版本

**请求**

```
POST /openapi/delivery/releases/k8s
```

**body 参数说明**

| 参数名              | 类型                                                               | 描述                                                   |
| ------------------- | ------------------------------------------------------------------ | ------------------------------------------------------ |
| `project_key`       | string                                                             | 项目标识                                               |
| `version_name`      | string                                                             | 版本名称                                               |
| `source`            | string                                                             | 来源，manual、from_env、from_version                   |
| `env_name`          | string                                                             | 环境名称，source 为 from_env/from_version 时有效       |
| `production`        | bool                                                               | 是否为生产环境，source 为 from_env/from_version 时有效 |
| `desc`              | string                                                             | 描述                                                   |
| `labels`            | []string                                                           | 标签                                                   |
| `image_registry_id` | string                                                             | 镜像仓库 ID                                            |
| `services`          | [][DeliveryVersionCreateService](#create-delivery-version-service) | 服务列表                                               |

<h4 id="create-delivery-version-service">DeliveryVersionCreateService 参数说明</h4>

| 参数名                   | 类型                                                   | 说明                                                              |
| ------------------------ | ------------------------------------------------------ | ----------------------------------------------------------------- |
| `service_name`           | string                                                 | 服务名称                                                          |
| `original_chart_version` | string                                                 | 源 Chart 版本，type 为 HelmChart 且 source 为 from_version 时必填 |
| `chart_version`          | string                                                 | Chart 版本，type 为 HelmChart 时有效                              |
| `yaml_content`           | string                                                 | Yaml 内容                                                         |
| `images`                 | [DeliveryVersionImage](#create-delivery-version-image) | 镜像列表                                                          |

<h4 id="create-delivery-version-image">DeliveryVersionImage 参数说明</h4>

| 参数名             | 类型                     | 说明                                                                                                 |
| ------------------ | ------------------------ | ---------------------------------------------------------------------------------------------------- |
| `container_name`   | string                   | 容器名称                                                                                             |
| `image_name`       | string                   | 镜像名称                                                                                             |
| `source_image`     | string                   | 源镜像地址                                                                                           |
| `source_image_tag` | string                   | 源镜像 tag                                                                                           |
| `target_image`     | string                   | 目标镜像地址                                                                                         |
| `target_image_tag` | string                   | 目标镜像 tag                                                                                         |
| `image_path`       | [ImagePath](#image-path) | 镜像路径，type 为 HelmChart 时必填，可从[查看环境详情接口](/cn/Zadig%20v4.0/api/env/#测试环境-2)获取 |
| `push_image`       | bool                     | 是否推送镜像                                                                                         |

<h4 id="image-path">ImagePath 参数说明</h4>

| 参数名      | 类型   | 说明             |
| ----------- | ------ | ---------------- |
| `repo`      | string | 镜像仓库名       |
| `namespace` | string | 镜像仓库命名空间 |
| `image`     | string | 镜像名           |
| `tag`       | string | 镜像 tag         |

**成功返回示例**

```json
{
  "message": "success"
}
```

## Helm Chart 项目创建版本

**请求**

```
POST /openapi/delivery/releases/helm
```

**body 参数说明**

| 参数名                     | 类型                                                                 | 描述                                           |
| -------------------------- | -------------------------------------------------------------------- | ---------------------------------------------- |
| `project_key`              | string                                                               | 项目标识                                       |
| `version_name`             | string                                                               | 版本名称                                       |
| `source`                   | string                                                               | 来源，manual、from_env、from_version           |
| `env_name`                 | string                                                               | 环境名称，source 为 from_env 时有效            |
| `production`               | bool                                                                 | 是否为生产环境，source 为 from_env 时有效      |
| `desc`                     | string                                                               | 描述                                           |
| `labels`                   | []string                                                             | 标签                                           |
| `image_registry_id`        | string                                                               | 镜像仓库 ID                                    |
| `original_chart_repo_name` | string                                                               | 源 Chart 仓库名，source 为 from_version 时必填 |
| `chart_repo_name`          | string                                                               | Chart 仓库名称                                 |
| `services`                 | [][DeliveryVersionCreateService](#create-delivery-version-service-2) | 服务列表                                       |

<h4 id="create-delivery-version-service-2">DeliveryVersionCreateService 参数说明</h4>

| 参数名                   | 类型                                                     | 说明                                                              |
| ------------------------ | -------------------------------------------------------- | ----------------------------------------------------------------- |
| `service_name`           | string                                                   | 服务名称                                                          |
| `original_chart_version` | string                                                   | 源 Chart 版本，type 为 HelmChart 且 source 为 from_version 时必填 |
| `chart_version`          | string                                                   | Chart 版本，type 为 HelmChart 时有效                              |
| `yaml_content`           | string                                                   | Yaml 内容                                                         |
| `images`                 | [DeliveryVersionImage](#create-delivery-version-image-2) | 镜像列表                                                          |

<h4 id="create-delivery-version-image-2">DeliveryVersionImage 参数说明</h4>

| 参数名             | 类型                       | 说明                                                                                                 |
| ------------------ | -------------------------- | ---------------------------------------------------------------------------------------------------- |
| `container_name`   | string                     | 容器名称                                                                                             |
| `image_name`       | string                     | 镜像名称                                                                                             |
| `source_image`     | string                     | 源镜像地址                                                                                           |
| `source_image_tag` | string                     | 源镜像 tag                                                                                           |
| `target_image`     | string                     | 目标镜像地址                                                                                         |
| `target_image_tag` | string                     | 目标镜像 tag                                                                                         |
| `image_path`       | [ImagePath](#image-path-2) | 镜像路径，type 为 HelmChart 时必填，可从[查看环境详情接口](/cn/Zadig%20v4.0/api/env/#测试环境-2)获取 |
| `push_image`       | bool                       | 是否推送镜像                                                                                         |

<h4 id="image-path-2">ImagePath 参数说明</h4>

| 参数名      | 类型   | 说明             |
| ----------- | ------ | ---------------- |
| `repo`      | string | 镜像仓库名       |
| `namespace` | string | 镜像仓库命名空间 |
| `image`     | string | 镜像名           |
| `tag`       | string | 镜像 tag         |

**成功返回示例**

```json
{
  "message": "success"
}
```

## 重试创建版本

**请求**

```
POST /openapi/delivery/releases/retry
```

**body 参数说明**

| 参数名       | 类型   | 描述     |
| ------------ | ------ | -------- |
| `id`         | string | 版本ID   |
| `projectKey` | string | 项目标识 |

**成功返回示例**

```json
{
  "message": "success"
}
```