---
title: Build
date: 2023-04-18 11:28:53
permalink: /en/Zadig v3.4/api/build/
---

## Create Build From Template

**Request**

```
POST /openapi/build?source=template
```

**body Parameter description**

|Parameter Name|Description|Required|Required|
|----------------|-------------------|---|---|
|`name`  |Build name|string|Trigger time, Unix timestamp|
|`project_key`  |Project identifier|string|Trigger time, Unix timestamp|
|`template_name` |Build template name| string|Trigger time, Unix timestamp|
|`target_services` |Service Configuration| [][TargetService](#TargetService)|Trigger time, Unix timestamp|


<h4 id="!">TargetService Parameter description</h4>

|Parameter Name|Description|Required|Required|
|---|---|---|---|
|`service_module`|Service Component Name|string|Trigger time, Unix timestamp|
|`service_name`|Service name|string|Trigger time, Unix timestamp|
|`repo_info`|Codebase information|[][RepoInfo](#RepoInfo)|Trigger time, Unix timestamp|
|`inputs`|Variable information|[][Input](#Input)|Trigger time, Unix timestamp|

<h4 id="!">RepoInfo Parameter description</h4>

|Parameter Name|Description|Required|Required|
|---|---|---|---|
|`codehost_name`|Code source identification|string|Trigger time, Unix timestamp|
|`repo_namespace`|The namespace to which the code base belongs (organization/personal)|string|Trigger time, Unix timestamp|
|`repo_name`|Codebase name|string|Trigger time, Unix timestamp|
|`branch`|Branch information|string|Trigger time, Unix timestamp|

<h4 id="!">Input Parameter description</h4>

|Parameter Name|Description|Required|Required|
|---|---|---|---|
|`key`|The key value of the variable|string|Trigger time, Unix timestamp|
|`value`|Value of variable|string|Trigger time, Unix timestamp|

**body Parameter example**

``` json
{
    "name": "demo-build",
    "project_key": "demo",
    "template_name": "demo-template",
    "target_services": [
        {
            "service_module": "aslan",
            "service_name": "zadigx",
            "repo_info": [
                {
                    "codehost_name": "github-demo",
                    "repo_namespace": "kr-test-org",
                    "repo_name": "zadig",
                    "branch": "main"
                }
            ],
            "inputs": [
                {
                    "key": "name",
                    "value": "admin"
                },
                {
                  "key": "password",
                  "value": "zadigx"
                }
            ]
        }
    ]
}
```

**Response**

```json
{
  "message": "success"
}
```

## Query Build List

**Request**

```
GET /openapi/build?projectKey=<project identifier>&pageNum=<当前页数>&pageSize=<当前页显示条数>
```

**query Parameter description**

| Parameter Name       | Required   | Description                    | Is it Required | Default Value |
| ------------ | ------ | ----------------------- | -------- | ------ |
| `projectKey` | string | Project identifier                | Trigger time, Unix timestamp       | None     |
| `pageNum`    | int    | Pagination parameters-current page count       | No       | 1      |
| `pageSize`   | int    | Pagination parameters-the number of pieces displayed on the current page | No       | 20     |

**Return Description**

| Parameter Name   | Required                | Description         |
| -------- | ------------------- | ------------ |
| `total`  | int                 | Total number of building blocks |
| `builds` | [][Build](#build-1) | Building module list |

<h4 id="!">Build Parameter description</h4>

| Parameter Name            | Required                                 | Description                                     |
| ----------------- | ------------------------------------ | ---------------------------------------- |
| `name`            | string                               | Build name                                 |
| `project_key`     | string                               | Project identifier                                 |
| `source`          | string                               | There are two ways to build: `zadig` , `jenkins` |
| `update_by`       | string                               | Updater                                   |
| `update_time`     | int                                  | Update Time                                 |
| `target_services` | [][TargetService](#target_service-1) | Service Component List                             |

<h4 id="!">TargetService Parameter description</h4>

| Parameter Name           | Required   | Description         |
| ---------------- | ------ | ------------ |
| `service_name`   | string | Service name     |
| `service_module` | string | Service Component Name |

**Return normally**

::: details

```json
{
    "total": 2,
    "builds": [
        {
            "name": "s-build",
            "project_key": "lilian-test",
            "source": "zadig",
            "update_by": "admin",
            "update_time": 1686192895,
            "target_services": [
                {
                    "service_name": "service1",
                    "service_module": "service1"
                },
                {
                    "service_name": "service2",
                    "service_module": "service2"
                }
            ]
        },
        {
            "name": "openapi-build",
            "project_key": "lilian-test",
            "source": "zadig",
            "update_by": "admin",
            "update_time": 1688040721,
            "target_services": [
                {
                    "service_name": "service1",
                    "service_module": "service1"
                }
            ]
        }
    ]
}
```

:::

## Get Build Details

**Request**

```
GET /openapi/build/:buildName/detail?projectKey=<project identifier>
```

**query Parameter description**

| Parameter Name       | Required   | Description     | Is it Required | Default Value |
| ------------ | ------ | -------- | -------- | ------ |
| `projectKey` | string | Project identifier | Trigger time, Unix timestamp       | None     |
| `serviceName`| string | Service name | Trigger time, Unix timestamp       | None     |
| `serviceModule`| string | Service Component Name | Trigger time, Unix timestamp       | None     |

**Path parameter description**

| Parameter Name      | Required   | Description     | Is it Required | Default Value |
| ----------- | ------ | -------- | -------- | ------ |
| `buildName` | string | Build name | Trigger time, Unix timestamp       | None     |

**Return Description**

::: details

```json
{
    "project_key": "lilian-test", // 项目标识
    "name": "openapi-build", // 构建名称
    "source": "",	// 构建方式，分别有 zadig,jenkins两种
    "target_services": [	// 服务列表
        {
            "service_name": "service1", // 服务名称
            "service_module": "service1" // 服务组件名称
        }
    ],
    "template_name": "test", // 模板名称
    "update_by": "admin",	// 更新的用户名称
    "update_time": 1690215924, // 更新时间，秒级时间戳
    "repos": [ // 代码源信息
      {
            "source": "gitee", // 有以下几种类型：github、gitlab、gerrit、codehub、gitee、gitee-enterprise、other
            "repo_owner": "liyue326",	// 组织名/用户名
            "repo_name": "hello",	// 代码库名称
            "remote_name": "origin", // Remote name
            "branch": "master",	// 分支名称
        		"address":"https://gitlab.com",	// 代码源
        		"checkout_path":"", // 克隆目录名
        		"submodules":false,	 // 子模块
        },
    ],
    "build_env": { // 构建环境
        "basic_image_id": "63047770931401b9baa6e396",	// 操作系统镜像ID
        "basic_image_label": "ubuntu 20.04",	// 操作系统镜像名称
        "installs": [	// 构建依赖的软件包列表
            {
                "name": "go",
                "version": "1.13"
            }
        ]
    },
    "advanced_settings": { // 高级配置
        "cluster_name": "local-20220823144517",	// 集群名称
        "timeout": 60,	// 构建超时时间
        "resource_spec": {	// 集群配置项列表
            "cpu_limit": 1000,
            "memory_limit": 512,
            "gpu_limit": ""
        },
      	"use_host_docker_daemon": false, // 是否使用宿主机docker daemon
        "cache_setting": {	// 缓存配置
            "enabled": false,	// 是否使用自定义工作空间
            "cache_dir": ""	// 自定义工作流空间下的缓存路径
        }
    },
    "build_script": "#!/bin/bash\nset -e",	// 构建脚本
    "parameters": [	// 自定义变量列表
        {
            "key": "a",
            "value": "1",
            "type": "string",
            "is_credential": false
        }
    ]
    "outputs": [	// 输出变量列表
        {
            "name": "IMAGE",
            "description": ""
        },
        {
            "name": "PKG_FILE",
            "description": ""
        },
        {
            "name": "xx",
            "description": ""
        }
    ],
    "post_build": {	// 添加步骤
        "docker_build": {	// 镜像构建配置
            "work_dir": "temp",	// 构建上下文目录
            "docker_file": "temp",	// Dockerfile 的绝对路径
            "build_args": "",	// 构建参数
            "source": "local",	// Dockerfile 来源
            "template_name": ""	// template名称（如果dockerfile来源是模板)
        },
        "object_storage_upload": {	// 文件存储
            "enabled": true,	// 是否使用工作空间缓存
            "object_storage_id": "63422e0690069fe35f4e62bb",	// sidebarMenu.objectStorage
            "upload_detail": [	// 上传文件配置
                {
                    "file_path": "test",
                    "abs_file_path": "",
                    "dest_path": "temp"
                }
            ]
        },
        "file_archive": {	// 二进制包存储
            "file_location": "temp"	// 二进制包存储路径
        },
        "scripts": "#!/bin/bash\nset -e"	// Shell 脚本
    }
}
```

:::

## Delete the Build

**Request**

```
DELETE /openapi/build?buildName=<构建名称>&projectKey=<project identifier>
```

**query Parameter description**

|Parameter Name|Description|Required|Required|
|----------------|-------------------|---|---|
|`buildName`  |Build name|string|Trigger time, Unix timestamp|
|`projectKey`  |Project identifier|string|Trigger time, Unix timestamp|

**Return Description**

```json
{
  "message": "success"
}
```