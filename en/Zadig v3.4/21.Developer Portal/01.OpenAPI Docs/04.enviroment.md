---
title: Environment
date: 2023-05-16 19:54:07
permalink: /en/Zadig v3.4/api/env/
---

## View the Environment List

### Test Environment

> Suitable for K8s YAML projects.

**Request**

```
GET /openapi/environments?projectKey=<project identifier>
```

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

**Return to the example**

::: details
``` json
[
        {
            "env_name": "dev",
            "cluster_id": "0123456789abcdef12345678",   # K8s 集群 ID
            "namespace": "k8s-fansitest-env-dev",       # K8s 命名空间
            "production": false,                        # 是否是生产环境
            "registry_id": "630c7ad700430c131062e245",  # 镜像仓库 ID
            "status": "success",                        # 环境状态，包括 success(正常)、failed(失败)、creating(正在创建)、updating(更新中)、deleting(删除中)、unknown(未知)、unstable(运行不稳定)、sleeping(睡眠中)
            "update_by": "admin",                       # 环境更新者
            "update_time": 1690186199                   # 最后一次更新时间，Unix 时间戳格式
        },
        {
            "env_name": "dev5",
            "cluster_id": "0123456789abcdef12345678",
            "namespace": "ai-test-2-env-dev",
            "production": false,
            "registry_id": "6350be2b4503905e98b4b771",
            "status": "success",
            "update_by": "admin",
            "update_time": 1690181832
        }
]
```
:::

### Production Environment

> Suitable for K8s YAML projects.

**Request**

```
GET /openapi/environments/production?projectKey=<project identifier>
```

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

**Return to the example**

::: details

``` json
[
        {
            "env_name": "dev",
            "cluster_id": "0123456789abcdef12345678",   # K8s 集群 ID
            "namespace": "k8s-fansitest-env-dev",       # K8s 命名空间
            "production": true,                        # 是否是生产环境
            "registry_id": "630c7ad700430c131062e245",  # 镜像仓库 ID
            "status": "success",                        # 环境状态，包括 success(正常)、failed(失败)、creating(正在创建)、updating(更新中)、deleting(删除中)、unknown(未知)、unstable(运行不稳定)、sleeping(睡眠中)
            "update_by": "admin",                       # 环境更新者
            "update_time": 1690186199                   # 最后一次更新时间，Unix 时间戳格式
        },
        {
            "env_name": "dev5",
            "cluster_id": "0123456789abcdef12345678",
            "namespace": "ai-test-2-env-dev",
            "production": true,
            "registry_id": "6350be2b4503905e98b4b771",
            "status": "success",
            "update_by": "admin",
            "update_time": 1690181832
        }
]
```

:::

## View Environment Details

> Suitable for K8s YAML projects.

### Test Environment
**Request**

```
GET /openapi/environments/<环境标识>?projectKey=<project identifier>
```

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

**Return to the example**

::: details
``` json
{
    "project_key": "simple-demo",              # 项目标识
    "env_key": "dev",                          # 环境标识
    "update_by": "admin",                       # 环境更新者
    "update_time": 1689933256,                  # 最后一次更新时间，Unix 时间戳格式
    "cluster_id": "0123456789abcdef12345678",   # K8s 集群 ID
    "namespace": "simple-demo-env-dev",         # K8s 命名空间
    "registry_id": "630c7ad700430c131062e245",  # 镜像仓库 ID
    "global_variables": [                       # 全局变量列表
        {
            "key": "cpuLimit",                  # 变量的键
            "value": "1000m",                   # 变量的值
            "type": "string",                   # 变量的类型，包括 string、bool、enum、yaml 四种
            "options": [],                      # 变量的可选值，当 type 为 enum 时该字段有意义
            "desc": "CPU 资源限制",              # 变量的描述信息
            "related_services": ["service1"]    # 变量关联的服务
        }
    ],
    "services": [                               # 服务列表
        {
            "service_name": "service2",         # 服务名称
            "containers": [                     # 服务组件信息
                {
                    "name": "myapp-1",          # 服务组件名称
                    "image": "koderover.tencentcloudcr.com/test/myapp-1:20230721164449-6-main", # 服务组件镜像
                    "image_name": "myapp-1"     # 服务组件镜像名称
                }
            ],
            "variable_kvs": [                   # 服务变量列表
                {
                    "key": "env1",
                    "value": "demo",
                    "type": "string",
                }
            ],
            "status": "running",               # 服务状态，包括 running(正在运行)、unstable(运行不稳定)、unstart(未开始)、failed(失败)、pending(挂起中)、unknown(未知)
            "type": "k8s"                      # 项目类型，恒定为 k8s
        }
    ],
    "status": "success"                        # 环境状态，包括 creating（创建中)、updating(更新中)、deleting(删除中)、succeeded(正常)、error(内部错误)、running(正在运行)、unstable(运行不稳定)、sleeping(睡眠中)、unknown(未知)
}
```
:::


### Production Environment

**Request**

```
GET /openapi/environments/production/<环境名称>?projectKey=<project identifier>
```

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

**Return to the example**


::: details
``` json
{
    "project_key": "simple-demo",              # 项目标识
    "env_key": "prod",                         # 环境标识
  	"env_name":"prod",												 # 环境名称
    "update_by": "admin",                       # 环境更新者
    "update_time": 1689933256,                  # 最后一次更新时间，Unix 时间戳格式
    "cluster_id": "0123456789abcdef12345678",   # K8s 集群 ID
    "namespace": "simple-demo-env-prod",        # K8s 命名空间
    "registry_id": "630c7ad700430c131062e245",  # 镜像仓库 ID
    "global_variables": [                       # 全局变量列表
        {
            "key": "cpuLimit",                  # 变量的键
            "value": "1000m",                   # 变量的值
            "type": "string",                   # 变量的类型，包括 string、bool、enum、yaml 四种
            "options": [],                      # 变量的可选值，当 type 为 enum 时该字段有意义
            "desc": "CPU 资源限制",              # 变量的描述信息
            "related_services": ["service1"]    # 变量关联的服务
        }
    ],
    "services": [                               # 服务列表
        {
            "service_name": "service2",         # 服务名称
            "containers": [                     # 服务组件信息
                {
                    "name": "myapp-1",          # 服务组件名称
                    "image": "koderover.tencentcloudcr.com/test/myapp-1:20230721164449-6-main", # 服务组件镜像
                    "image_name": "myapp-1"     # 服务组件镜像名称
                }
            ],
            "variable_kvs": [                   # 服务变量列表
                {
                    "key": "env1",
                    "value": "demo",
                    "type": "string",
                }
            ],
            "status": "running",               # 服务状态，包括 running(正在运行)、unstable(运行不稳定)、unstart(未开始)、failed(失败)、pending(挂起中)、unknown(未知)
            "type": "k8s"                      # 项目类型，恒定为 k8s
        }
    ],
    "status": "success"                        # 环境状态，包括 creating（创建中)、updating(更新中)、deleting(删除中)、succeeded(正常)、error(内部错误)、running(正在运行)、unstable(运行不稳定)、sleeping(睡眠中)、unknown(未知)
}
```
:::

## View Environmental Service Details

### Test Environment

**Request**

```
GET /openapi/environments/<环境标识>/services/<服务名称>
```

**Query Parameter description**

| Parameter Name         | Description                                                       | Required   | Required |
| -------------- | ---------------------------------------------------------- | ------ | ---- |
| `projectKey`   | Project identifier                                                   | string | Trigger time, Unix timestamp   |
| `workLoadtype` | The optional values are as follows:<br> `StatefulSet`<br> `Deployment`<br> `CronJob` | string | Trigger time, Unix timestamp   |

**Return to the example**

::: details
``` json
{
  "service_name": "service1",
  "scales": [
    {
      "name": "service1",
      "type": "Deployment",
      "images": [
        {
          "name": "service1",
          "image": "koderover.tencentcloudcr.com/test/service1:20231214162411",
          "image_name": "service1"
        }
      ],
      "pods": [
        {
          "kind": "ReplicaSet",
          "name": "service1-5b94c8f98f-hsqfl",
          "status": "Running",
          "age": "34d",
          "createtime": 1704444315,
          "ip": "10.200.2.76",
          "labels": {
            "app.kubernetes.io/instance": "service1",
            "app.kubernetes.io/name": "yaml",
            "pod-template-hash": "5b94c8f98f",
            "s-product": "yaml",
            "s-service": "service1"
          },
          "containers": [
            {
              "name": "service1",
              "image": "koderover.tencentcloudcr.com/test/service1:20231214162411",
              "restart_count": 0,
              "status": "running",
              "ready": true,
              "ports": [
                {
                  "containerPort": 20211,
                  "protocol": "TCP"
                }
              ],
              "message": "",
              "reason": "",
              "started_at": 1704444316
            }
          ],
          "node_name": "172.16.0.46",
          "host_ip": "172.16.0.46",
          "enable_debug_container": false,
          "pod_ready": true,
          "containers_ready": true,
          "containers_message": ""
        }
      ],
      "replicas": 1,
      "zadigx_release_type": "",
      "zadigx_release_tag": ""
    }
  ],
  "ingress": [],
  "service_endpoints": [
    {
      "name": "service1",
      "age": "119d",
      "labels": {
        "app.kubernetes.io/instance": "service1",
        "app.kubernetes.io/name": "yaml",
        "s-product": "yaml",
        "s-service": "service1"
      },
      "endpoints": [
        {
          "service_name": "service1",
          "service_port": 20211,
          "node_port": 30593
        }
      ]
    }
  ],
  "cron_jobs": [],
  "namespace": "yaml-env-dev",
  "env_name": "dev",
  "product_name": "yaml",
  "group_name": ""
}
```
:::

### Production Environment

**Request**

```
GET /openapi/environments/production/<环境标识>/services/<服务名称>
```

**Query Parameter description**

| Parameter Name         | Description                                                       | Required   | Required |
| -------------- | ---------------------------------------------------------- | ------ | ---- |
| `projectKey`   | Project identifier                                                   | string | Trigger time, Unix timestamp   |
| `workLoadtype` | The optional values are as follows:<br> `StatefulSet`<br> `Deployment`<br> `CronJob` | string | Trigger time, Unix timestamp   |

**Return to the example**

::: details
``` json
{
  "service_name": "service1",
  "scales": [
    {
      "name": "service1",
      "type": "Deployment",
      "images": [
        {
          "name": "service1",
          "image": "koderover.tencentcloudcr.com/test/service1:20231214162411",
          "image_name": "service1"
        }
      ],
      "pods": [
        {
          "kind": "ReplicaSet",
          "name": "service1-5b94c8f98f-hsqfl",
          "status": "Running",
          "age": "34d",
          "createtime": 1704444315,
          "ip": "10.200.2.76",
          "labels": {
            "app.kubernetes.io/instance": "service1",
            "app.kubernetes.io/name": "yaml",
            "pod-template-hash": "5b94c8f98f",
            "s-product": "yaml",
            "s-service": "service1"
          },
          "containers": [
            {
              "name": "service1",
              "image": "koderover.tencentcloudcr.com/test/service1:20231214162411",
              "restart_count": 0,
              "status": "running",
              "ready": true,
              "ports": [
                {
                  "containerPort": 20211,
                  "protocol": "TCP"
                }
              ],
              "message": "",
              "reason": "",
              "started_at": 1704444316
            }
          ],
          "node_name": "172.16.0.46",
          "host_ip": "172.16.0.46",
          "enable_debug_container": false,
          "pod_ready": true,
          "containers_ready": true,
          "containers_message": ""
        }
      ],
      "replicas": 1,
      "zadigx_release_type": "",
      "zadigx_release_tag": ""
    }
  ],
  "ingress": [],
  "service_endpoints": [
    {
      "name": "service1",
      "age": "119d",
      "labels": {
        "app.kubernetes.io/instance": "service1",
        "app.kubernetes.io/name": "yaml",
        "s-product": "yaml",
        "s-service": "service1"
      },
      "endpoints": [
        {
          "service_name": "service1",
          "service_port": 20211,
          "node_port": 30593
        }
      ]
    }
  ],
  "cron_jobs": [],
  "namespace": "yaml-env-dev",
  "env_name": "dev",
  "product_name": "yaml",
  "group_name": ""
}
```
:::

## Create a New Environment

> Suitable for K8s YAML projects.

### Test Environment

**Request**

```
POST /openapi/environments?projectKey=<project identifier>
```

**Body Parameter description**

| Parameter Name             | Description         | Required                                | Required |
| ------------------ | ------------ | ----------------------------------- | ---- |
| `env_key`          | Environmental Identification     | string                              | Trigger time, Unix timestamp   |
| `cluster_id`       | K8s cluster ID  | string                              | Trigger time, Unix timestamp   |
| `namespace`        | K8s namespace | string                              | Trigger time, Unix timestamp   |
| `registry_id`      | Mirror Repository ID  | string                              | Trigger time, Unix timestamp   |
| `env_configs`      | Environment Configuration     | [][EnvConfig](#EnvConfig)           | No   |
| `global_variables` | Global Variables     | [][GlobalVariable](#GlobalVariable) | No   |
| `services`         | Service List     | [][Service](#Service)               | No   |

<h4 id="!">EnvConfig Parameter description</h4>

| Parameter Name                | Description                                                                          | Required   | Required |
| --------------------- | ----------------------------------------------------------------------------- | ------ | ---- |
| `yaml_data`           | YAML content for environment configuration                                                          | string | Trigger time, Unix timestamp   |
| `common_env_cfg_type` | The type of environment configuration, optional values are as follows:<br> `ConfigMap`<br> `Ingress`<br> `Secret`<br> `PVC` | string | Trigger time, Unix timestamp   |

<h4 id="!">GlobalVariable Parameter description</h4>

| Parameter Name  | Description     | Required   | Required |
| ------- | -------- | ------ | ---- |
| `key`   | The key of the variable | string | Trigger time, Unix timestamp   |
| `value` | Value of variable | string | Trigger time, Unix timestamp   |

<h4 id="!">Service Parameter description</h4>

| Parameter Name         | Description                        | Required                        | Required |
| -------------- | --------------------------- | --------------------------- | ---- |
| `service_name` | Service name                    | string                      | Trigger time, Unix timestamp   |
| `type`         | Service type, just specify it as `k8s` | string                      | Trigger time, Unix timestamp   |
| `containers`   | Mirror information of the service              | [][Container](#Container)   | Trigger time, Unix timestamp   |
| `variable_kvs` | Service variable configuration                | [][VariableKV](#VariableKV) | No   |

<h4 id="!">Container Parameter description</h4>

| Parameter Name       | Description                                                              | Required   | Required |
| ------------ | ----------------------------------------------------------------- | ------ | ---- |
| `image`      | The complete mirror address, for example: `koderover.demo.com/public/service1:latest` | string | Trigger time, Unix timestamp   |
| `image_name` | The image name                                                          | string | Trigger time, Unix timestamp   |
| `name`       | Service Component Name                                                      | string | Trigger time, Unix timestamp   |

<h4 id="!">VariableKV Parameter description</h4>

| Parameter Name                | Description             | Required   | Required                                |
| --------------------- | ---------------- | ------ | ----------------------------------- |
| `key`                 | The key of the variable         | string | Trigger time, Unix timestamp                                  |
| `value`               | Value of variable         | string | Choose one of `use_global_variable` parameters |
| `use_global_variable` | Whether to use global variables | bool   | Choose one of `value` parameters               |

**Body Parameter example**

::: details
``` json
{
    "env_key": "dev7",
    "cluster_id": "0123456789abcdef12345678",
    "namespace": "ai-test-2-env-dev",
    "registry_id": "6350be2b4503905e98b4b771",
    "is_public": true,
    "global_variables": [
        {
            "key": "cpuLimit",
            "value": "15m"
        }
    ],
    "services": [
        {
            "service_name": "service2",
            "type": "k8s",
            "containers": [
                {
                    "image": "koderover.tencentcloudcr.com/test/service2:20230730070002-38-main",
                    "image_name": "service2",
                    "name": "service2"
                }
            ],
            "variable_kvs": [
                {
                    "key": "cpu",
                    "value": "8m"
                },
                {
                    "key":"cpuLimit",
                    "value":"15m"
                }
            ]
        }
    ],
    "env_configs": [
        {
            "yaml_data": "apiVersion: v1\ndata:\n  root-cert.pem: |\n    -----BEGIN CERTIFICATE-----\n    MIIC/TCCAeWgAwIBAgIRAISZur/+Sm1i2dv4w5qWhy0wDQYJKoZIhvcNAQELBQAw\n    GDEWMBQGA1UEChMNY2x1c3Rlci5sb2NhbDAeFw0yMjA4MTUwMjM5MTdaFw0zMjA4\n    MTIwMjM5MTdaMBgxFjAUBgNVBAoTDWNsdXN0ZXIubG9jYWwwggEiMA0GCSqGSIb3\n    DQEBAQUAA4IBDwAwggEKAoIBAQDQWPcRpknooTvvR8rg9XOXtOV2XyW2mDCBhQ0E\n    THTQI17l5UK+AkhifJwUeGcc6KsZvBff7ksf5eQ6e1XBkwhEFTn0QBNTQwzVH/gz\n    dVLB/SYgDKZyUBq3N2E0V1tYsrXE/Mc5qRcnBwscAdOcH5gpW3ZxfRUr7t40DY0H\n    Im8RIajIB7UyT9lo+unaPozF5AuIN4ylv6XGcO1voXimCXNg5r2T/ATTA/vqJcS2\n    ZlaT/85+cZCycu8ZwZaVNgxlyjE1CgUBEdMxy0svMXpJvDondEZEPfZVuB1X2FUL\n    fczThsA7XmBvBYKXoKD7cAGlJS1I2nkfxXk+dkN+tolDQA6NAgMBAAGjQjBAMA4G\n    A1UdDwEB/wQEAwICBDAPBgNVHRMBAf8EBTADAQH/MB0GA1UdDgQWBBS1JbJ810a/\n    +KEqd78PtqTKRu+iqDANBgkqhkiG9w0BAQsFAAOCAQEAy833M/pdnLkKmZK9NaTp\n    Ten5TQdxhRlPuG3dBfU45VXQ0IhgO7Er0caPagMaVPkqdfuUcd5sT5lfEiJUtt3B\n    bOhyPK09GkD7muhO7Bx1o+qAPXkCjf0JRcAgQcpZ5va72V6bB8CJ5+6YoQV4eQGa\n    mF80vbzPx3zR6At+3JAZaMhbXItBWJi5ULIGMaJ3JRUvqBMG1jsZdeqOa/fTjVc1\n    6gdX/O9eZjfRdnUiBv4kCD00nr74crXfvAmQGDX/EbNqYGLNHqAdqRgibUYowvEC\n    9gaZfvKU4lOaWYnwE4RlJ1Q6uhVgH45fFiq8pAeflSh56TLbjRfi/VM2lg3GN+cm\n    6g==\n    -----END CERTIFICATE-----\nkind: ConfigMap\nmetadata:\n  creationTimestamp: \"2023-07-06T08:01:16Z\"\n  labels:\n    istio.io/config: \"true\"\n  name: istio-ca-root-cert-test\n  namespace: ai-test-2-env-dev\n  selfLink: /api/v1/namespaces/ai-test-2-env-dev/configmaps/istio-ca-root-cert\n  uid: 767723b1-8bb2-4c51-92fd-d224bf0c0dc5\n",
            "common_env_cfg_type": "ConfigMap"
        }
    ]
}
```
:::

**Response**

```json
{
  "message": "success"
}
```

### Production Environment

**Request**

```
POST /openapi/environments/production?projectKey=<project identifier>
```

**Body Parameter description**

| Parameter Name        | Description         | Required   | Required |
| ------------- | ------------ | ------ | ---- |
| `env_key`     | Environmental Identification     | string | Trigger time, Unix timestamp   |
| `env_name`    | Environment name     | string | No   |
| `cluster_id`  | K8s cluster ID  | string | Trigger time, Unix timestamp   |
| `namespace`   | K8s namespace | string | Trigger time, Unix timestamp   |
| `registry_id` | Mirror Repository ID  | string | Trigger time, Unix timestamp   |

**Response**

```json
{
  "message": "success"
}
```


## Editing Environment

> Suitable for K8s YAML projects.

### Test Environment

**Request**

```
PUT /openapi/environments/<环境标识>?projectKey=<project identifier>
```

**Body Parameter description**

| Parameter Name        | Description        | Required   | Required |
| ------------- | ----------- | ------ | ---- |
| `registry_id` | Mirror Repository ID | string | Trigger time, Unix timestamp   |

**Response**

```json
{
  "message": "success"
}
```

### Production Environment

**Request**

```
PUT /openapi/environments/production/<环境标识>?projectKey=<project identifier>
```

**Body Parameter description**

| Parameter Name        | Description        | Required   | Required |
| ------------- | ----------- | ------ | ---- |
| `registry_id` | Mirror Repository ID | string | No   |
| `env_name`    | Environment name    | string | No   |

**Response**

```json
{
  "message": "success"
}
```

## Delete Environment

> Suitable for K8s YAML projects.

### Test Environment

**Request**

```
DELETE /openapi/environments/<环境标识>?projectKey=<project identifier>&isDelete=true
```

**Query Parameter description**

| Parameter Name       | Description                                  | Required   | Required |
| ------------ | ------------------------------------- | ------ | ---- |
| `projectKey` | Project identifier                              | string | Trigger time, Unix timestamp   |
| `isDelete`   | Whether to delete the K8s namespace and services corresponding to the environment | bool   | Trigger time, Unix timestamp   |

**Response**

```json
{
  "message": "success"
}
```

### Production Environment

**Request**

```
DELETE /openapi/environments/production/<环境标识>?projectKey=<project identifier>
```

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

**Response**

```json
{
  "message": "success"
}
```

## Add a Service

> Suitable for K8s YAML projects.

### Test Environment

**Request**

```
POST /openapi/environments/service/yaml?projectKey=<project identifier>
```

**Body Parameter description**

| Parameter Name         | Description                   | Required                           | Required |
| -------------- | ---------------------- | ------------------------------ | ---- |
| `env_key`      | Environmental Identification               | string                         | Trigger time, Unix timestamp   |
| `service_list` | List of services that need to be added to the environment | [] [Service](#service-%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E) | Trigger time, Unix timestamp   |

**Service Parameter description**

| Parameter Name         | Description         | Required                                 | Required |
| -------------- | ------------ | ------------------------------------ | ---- |
| `service_name` | Service name     | string                               | Trigger time, Unix timestamp   |
| `variable_kvs` | Service variable list | [][VariableKV](#VariableKV) | No   |

Body parameter example

::: details
``` json
{
  "env_key": "dev",
  "service_list": [
    {
      "service_name": "service2",
      "variable_kvs": [
        {
          "key": "cpuLimit",
          "use_global_variable":true
        },
        {
          "key": "port",
          "value": "20221"
        }
      ]
    }
  ]
}
```
:::

**Response**

```json
{
  "message": "success"
}
```

### Production Environment

**Request**

```
POST /openapi/environments/production/service/yaml?projectKey=<project identifier>
```

**Body Parameter description**

| Parameter Name         | Description                   | Required                           | Required |
| -------------- | ---------------------- | ------------------------------ | ---- |
| `env_key`      | Environmental Identification               | string                         | Trigger time, Unix timestamp   |
| `service_list` | List of services that need to be added to the environment | [] [Service](#service-%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E) | Trigger time, Unix timestamp   |

**Service Parameter description**

| Parameter Name         | Description         | Required                                 | Required |
| -------------- | ------------ | ------------------------------------ | ---- |
| `service_name` | Service name     | string                               | Trigger time, Unix timestamp   |
| `variable_kvs` | Service variable list | [] [VariableKV](#VariableKV-%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E) | No   |

**VariableKV Parameter description**

| Parameter Name                | Description                 | Required   | Required                                          |
| --------------------- | -------------------- | ------ | --------------------------------------------- |
| `key`                 | The key of the variable             | string | Trigger time, Unix timestamp                                            |
| `value`               | Value of variable             | string | No need to set when `use_global_variable` is `true` |
| `use_global_variable` | Whether to use environment global variables | bool   | When set to `true` , the `value` parameter is invalid            |

**Body Parameter example**

::: details
``` json
{
  "env_key": "dev",
  "service_list": [
    {
      "service_name": "service2",
      "variable_kvs": [
        {
          "key": "cpuLimit",
          "use_global_variable":true
        },
        {
          "key": "port",
          "value": "20221"
        }
      ]
    }
  ]
}
```
:::

**Response**

```json
{
  "message": "success"
}
```

## Update Service

> Suitable for K8s YAML projects.

### Test Environment

**Request**

```
PUT /openapi/environments/<环境标识>/services?projectKey=<project identifier>
```

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

**Body Parameter description**

| Parameter Name         | Description         | Required                           | Required |
| -------------- | ------------ | ------------------------------ | ---- |
| `service_list` | Service variable list | [] [Service](#Service-%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E) | Trigger time, Unix timestamp   |

**Service Parameter description**

| Parameter Name         | Description         | Required                                 | Required |
| -------------- | ------------ | ------------------------------------ | ---- |
| `service_name` | Service name     | string                               | Trigger time, Unix timestamp   |
| `variable_kvs` | Service variable list | [] [VariableKV](#VariableKV-%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E) | No   |

**Body Parameter example**

::: details
``` json
{
    "service_list": [
    {
      "service_name": "service2",
      "variable_kvs": [
        {
          "key": "cpu",
          "value": "4m",
          "use_global_variable":true
        }
      ]
    }
  ]
}
```
:::

**Response**

```json
{
  "message": "success"
}
```

### Production Environment

**Request**

```
PUT /openapi/environments/production/<环境标识>/services?projectKey=<project identifier>
```

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

**Body Parameter description**

| Parameter Name         | Description         | Required                           | Required |
| -------------- | ------------ | ------------------------------ | ---- |
| `service_list` | Service variable list | [] [Service](#Service-%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E) | Trigger time, Unix timestamp   |

**Service Parameter description**

| Parameter Name         | Description         | Required                                 | Required |
| -------------- | ------------ | ------------------------------------ | ---- |
| `service_name` | Service name     | string                               | Trigger time, Unix timestamp   |
| `variable_kvs` | Service variable list | [] [VariableKV](#VariableKV-%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E) | No   |

**Body Parameter example**

::: details
``` json
{
    "service_list": [
    {
      "service_name": "service2",
      "variable_kvs": [
        {
          "key": "cpu",
          "value": "4m",
          "use_global_variable":true
        }
      ]
    }
  ]
}
```
:::

**Response**

```json
{
  "message": "success"
}
```

## Delete Service

> Suitable for K8s YAML projects.

### Test Environment

**Request**

```
DELETE /openapi/environments/service/yaml?projectKey=<project identifier>
```

**Body Parameter description**

| Parameter Name          | Description                       | Required     | Required |
| --------------- | -------------------------- | -------- | ---- |
| `env_key`       | Environmental Identification                   | string   | Trigger time, Unix timestamp   |
| `service_names` | List of services that need to be deleted from the environment | []string | Trigger time, Unix timestamp   |

**Response**

```json
{
  "message": "success"
}
```

### Production Environment

**Request**

```
DELETE /openapi/environments/production/service/yaml?projectKey=<project identifier>
```

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

**Body Parameter description**

| Parameter Name          | Description                       | Required     | Required |
| --------------- | -------------------------- | -------- | ---- |
| `env_key`       | Environmental Identification                   | string   | Trigger time, Unix timestamp   |
| `service_names` | List of services that need to be deleted from the environment | []string | Trigger time, Unix timestamp   |

**Response**

```json
{
  "message": "success"
}
```

## View Global Variables

> Suitable for K8s YAML projects.

### Test Environment

**Request**

```
GET /openapi/environments/<环境标识>/variable?projectKey=<project identifier>
```

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

**Return to the example**

::: details
```json
[
    {
        "key": "cpuLimit",                           # 全局变量的键
        "value": "1000m",                            # 全局变量的值
        "type": "string",                            # 全局变量的类型，包括 string、bool、yaml、enum 四种
        "options": [],                               # type 为 enum 时，全局变量的可选值
        "desc": "CPU Limit",                         # 全局变量描述
        "related_services": ["service1", "service2"] # 关联服务列表
    }
]
```
:::

### Production Environment

**Request**

```
GET /openapi/environments/production/<环境标识>/variable?projectKey=<project identifier>
```

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

**Return to the example**

::: details
```json
[
    {
        "key": "cpuLimit",                           # 全局变量的键
        "value": "1000m",                            # 全局变量的值
        "type": "string",                            # 全局变量的类型，包括 string、bool、yaml、enum 四种
        "options": [],                               # type 为 enum 时，全局变量的可选值
        "desc": "CPU Limit",                         # 全局变量描述
        "related_services": ["service1", "service2"] # 关联服务列表
    }
]
```
:::

## Update Global Variables
::: tip
1. Suitable for K8s YAML projects.
2. After the global variable is updated, the associated services will be updated synchronously.
:::

### Test Environment

**Request**

```
PUT /openapi/environments/<环境标识>/variable?projectKey=<project identifier>
```

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

**Body Parameter description**

| Parameter Name             | Description                   | Required                                 | Required |
| ------------------ | ---------------------- | ------------------------------------ | ---- |
| `global_variables` | List of global variables that need to be updated | [] [VariableKV](#VariableKV-%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E) | Trigger time, Unix timestamp   |

**VariableKV Parameter description**

| Parameter Name  | Description     | Required   | Required |
| ------- | -------- | ------ | ---- |
| `key`   | The key of the variable | string | Trigger time, Unix timestamp   |
| `value` | Value of variable | string | Trigger time, Unix timestamp   |

**Response**

```json
{
  "message": "success"
}
```

### Production Environment

**Request**

```
PUT /openapi/environments/production/<环境标识>/variable?projectKey=<project identifier>
```

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

**Body Parameter description**

| Parameter Name             | Description                   | Required                                 | Required |
| ------------------ | ---------------------- | ------------------------------------ | ---- |
| `global_variables` | List of global variables that need to be updated | [] [VariableKV](#VariableKV-%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E) | Trigger time, Unix timestamp   |

**VariableKV Parameter description**

| Parameter Name  | Description     | Required   | Required |
| ------- | -------- | ------ | ---- |
| `key`   | The key of the variable | string | Trigger time, Unix timestamp   |
| `value` | Value of variable | string | Trigger time, Unix timestamp   |

**Response**

```json
{
  "message": "success"
}
```

## Add Environment Configuration

> Suitable for K8s YAML projects.

### Test Environment

**Request**

```
POST /openapi/environments/<环境标识>/envcfgs?projectKey=<project identifier>
```

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

**Body Parameter description**

| Parameter Name                | Description                                                                          | Required   | Required |
| --------------------- | ----------------------------------------------------------------------------- | ------ | ---- |
| `name`                | The name of the environment configuration                                                                | string | Trigger time, Unix timestamp   |
| `common_env_cfg_type` | The type of environment configuration, optional values are as follows:<br> `ConfigMap`<br> `Ingress`<br> `Secret`<br> `PVC` | string | Trigger time, Unix timestamp   |
| `yaml_data`           | Contents of environment configuration                                                                | string | Trigger time, Unix timestamp   |

**Body Example**

::: details
``` json
{
    "name": "game-demo",
    "common_env_cfg_type": "ConfigMap",
    "yaml_data": "apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: game-demo\ndata:\n  player_initial_lives: \"3\"\n  ui_properties_file_name: \"user-interface.properties\"\n  game.properties: |\n    enemy.types=aliens,monsters\n    player.maximum-lives=5    \n  user-interface.properties: |\n    color.good=purple\n    color.bad=yellow\n    allow.textmode=true"
}
```
:::

**Response**

```json
{
  "message": "success"
}
```

### Production Environment

**Request**

```
POST /openapi/environments/production/<环境标识>/envcfgs?projectKey=<project identifier>
```

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

**Body Parameter description**

| Parameter Name                | Description                                                                          | Required   | Required |
| --------------------- | ----------------------------------------------------------------------------- | ------ | ---- |
| `name`                | The name of the environment configuration                                                                | string | Trigger time, Unix timestamp   |
| `common_env_cfg_type` | The type of environment configuration, optional values are as follows:<br> `ConfigMap`<br> `Ingress`<br> `Secret`<br> `PVC` | string | Trigger time, Unix timestamp   |
| `yaml_data`           | Contents of environment configuration                                                                | string | Trigger time, Unix timestamp   |

**Body Example**

::: details
``` json
{
    "name": "game-demo",
    "common_env_cfg_type": "ConfigMap",
    "yaml_data": "apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: game-demo\ndata:\n  player_initial_lives: \"3\"\n  ui_properties_file_name: \"user-interface.properties\"\n  game.properties: |\n    enemy.types=aliens,monsters\n    player.maximum-lives=5    \n  user-interface.properties: |\n    color.good=purple\n    color.bad=yellow\n    allow.textmode=true"
}
```
:::

**Response**

```json
{
  "message": "success"
}
```

## View the Environment Configuration List

> Suitable for K8s YAML projects.

### Test Environment

**Request**

```
GET /openapi/environments/<环境标识>/envcfgs?projectKey=<project identifier>&type=<环境配置的类型>
```

**Query Parameter description**

| Parameter Name       | Description                                                                          | Required   | Required |
| ------------ | ----------------------------------------------------------------------------- | ------ | ---- |
| `projectKey` | Project identifier                                                                      | string | Trigger time, Unix timestamp   |
| `type`       | The type of environment configuration, optional values are as follows:<br> `ConfigMap`<br> `Ingress`<br> `Secret`<br> `PVC` | string | Trigger time, Unix timestamp   |

**Return to the example**

::: details
``` json
[
    {
        "name": "game-demo",                # 环境配置的名称
        "env_name": "dev",                  # 环境名称
        "project_name": "simple-demo",      # 项目标识
        "common_env_cfg_type": "ConfigMap", # 环境配置的类型
    },
    {
        "name": "istio-ca-root-cert",
        "env_name": "dev",
        "project_name": "simple-demo",
        "common_env_cfg_type": "ConfigMap",
        "update_time": 1687259964
    }
]
```
:::

### Production Environment

**Request**

```
GET /openapi/environments/production/<环境标识>/envcfgs?projectKey=<project identifier>&type=<环境配置的类型>
```

**Query Parameter description**

| Parameter Name       | Description                                                                          | Required   | Required |
| ------------ | ----------------------------------------------------------------------------- | ------ | ---- |
| `projectKey` | Project identifier                                                                      | string | Trigger time, Unix timestamp   |
| `type`       | The type of environment configuration, optional values are as follows:<br> `ConfigMap`<br> `Ingress`<br> `Secret`<br> `PVC` | string | Trigger time, Unix timestamp   |

**Return to the example**

::: details
``` json
[
    {
        "name": "game-demo",                # 环境配置的名称
        "env_name": "dev",                  # 环境名称
        "project_name": "simple-demo",      # 项目标识
        "common_env_cfg_type": "ConfigMap", # 环境配置的类型
    },
    {
        "name": "istio-ca-root-cert",
        "env_name": "dev",
        "project_name": "simple-demo",
        "common_env_cfg_type": "ConfigMap",
        "update_time": 1687259964
    }
]
```
:::

## View Environment Configuration Details

> Suitable for K8s YAML projects.

### Test Environment

**Request**

```
GET /openapi/environments/<环境标识>/envcfg/<环境配置名称>?projectKey=<project identifier>&type=<环境配置的类型>
```

**Query Parameter description**

| Parameter Name       | Description                                                                          | Required   | Required |
| ------------ | ----------------------------------------------------------------------------- | ------ | ---- |
| `projectKey` | Project identifier                                                                      | string | Trigger time, Unix timestamp   |
| `type`       | The type of environment configuration, optional values are as follows:<br> `ConfigMap`<br> `Ingress`<br> `Secret`<br> `PVC` | string | Trigger time, Unix timestamp   |

**Return to the example**

::: details 手动输入的环境配置示例
``` json
{
   "configMap_detail": { // configMap环境配置资源详情，其他资源类型此处的key为：ingress_detail、secret_detail、pvc_detail
      "name": "istio-ca-root-cert",          # 环境配置的名称
      "common_env_cfg_type": "ConfigMap",    # 环境配置的类型
      "created_time": 1686225615,            # 环境配置的创建时间，Unix 时间戳格式
      "env_key": "dev",                      # 环境标识
      "product_key": "simple-demo",         # 项目标识
      "yaml_data": ".......",                # 环境配置的 YAML 内容，string 格式
      "source_detail": {                     # 代码库配置，环境配置是从代码库导入时该字段有信息
          "git_repo_config": {
              "codehost_key": "kr-test",     # 代码源标识
              "namespace": "kr-test-org1",   # 组织名/用户名
              "owner": "kr-test-org1",       # 代码库拥有者
              "repo": "config-data",         # 代码库
              "branch": "main",              # 代码分支
          },
          "load_path": "cm.yaml",            # 文件路径
          "auto_sync": true                  # 自动同步开关
      }
	}
}
```
:::

### Production Environment

**Request**

```
GET /openapi/environments/production/<环境标识>/envcfg/<环境配置名称>?projectKey=<project identifier>&type=<环境配置的类型>
```

**Query Parameter description**

| Parameter Name       | Description                                                                          | Required   | Required |
| ------------ | ----------------------------------------------------------------------------- | ------ | ---- |
| `projectKey` | Project identifier                                                                      | string | Trigger time, Unix timestamp   |
| `type`       | The type of environment configuration, optional values are as follows:<br> `ConfigMap`<br> `Ingress`<br> `Secret`<br> `PVC` | string | Trigger time, Unix timestamp   |

**Return to the example**

::: details 手动输入的环境配置示例
``` json
{
  "configMap_detail": { // configMap环境配置资源详情，其他资源类型此处的key为：ingress_detail、secret_detail、pvc_detail
      "name": "istio-ca-root-cert",          # 环境配置的名称
      "common_env_cfg_type": "ConfigMap",    # 环境配置的类型
      "created_time": 1686225615,            # 环境配置的创建时间，Unix 时间戳格式
      "env_key": "dev",                      # 环境标识
      "product_key": "simple-demo",          # 项目标识
      "yaml_data": ".......",                # 环境配置的 YAML 内容，string 格式
      "source_detail": {                     # 代码库配置，环境配置是从代码库导入时该字段有信息
          "git_repo_config": {
              "codehost_key": "kr-test",     # 代码源标识
              "namespace": "kr-test-org1",   # 组织名/用户名
              "owner": "kr-test-org1",       # 代码库拥有者
              "repo": "config-data",         # 代码库
              "branch": "main",              # 代码分支
          },
          "load_path": "cm.yaml",            # 文件路径
          "auto_sync": true                  # 自动同步开关
      }
	}
}
```
:::

## Update Environment Configuration

> Suitable for K8s YAML projects.

**Request**

```
PUT /openapi/environments/envcfgs?projectKey=<project identifier>
```

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

**Body Parameter description**

| Parameter Name                | Description                                                        | Required   | Required |
| --------------------- | ----------------------------------------------------------- | ------ | ---- |
| `name`                | The configuration name to be updated                                          | string | Trigger time, Unix timestamp   |
| `env_key`             | Environmental Identification                                                    | string | Trigger time, Unix timestamp   |
| `common_env_cfg_type` | The types of environment configuration, optional values are as follows: Secret, ConfigMap, PVC, Ingress | string | Trigger time, Unix timestamp   |
| `yaml_data`           | Configured YAML content                                            | string | Trigger time, Unix timestamp   |

**Body Parameter example**

::: details
``` json
{
    "name":"game-demo",
    "env_key":"dev",
    "common_env_cfg_type":"ConfigMap",
    "yaml_data": "apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: game-demo\ndata:\n  player_initial_lives: \"3\"\n  ui_properties_file_name: \"user-interface.properties\"\n\n  game.properties: |\n    enemy.types=aliens,monsters\n    player.maximum-lives=25    \n  user-interface.properties: |\n    color.good=purple\n    color.bad=yellow\n    allow.textmode=true    "
}
```
:::

**Response**

```json
{
  "message": "success"
}
```

## Delete the Environment Configuration

> Suitable for K8s YAML projects.

### Test Environment

#### Request

```
DELETE /openapi/environments/<环境标识>/envcfg/<环境配置名称>?projectKey=<project identifier>&type=<环境配置的类型>
```

#### Query Parameter Description

| Parameter Name       | Description                                                                          | Required   | Required |
| ------------ | ----------------------------------------------------------------------------- | ------ | ---- |
| `projectKey` | Project identifier                                                                      | string | Trigger time, Unix timestamp   |
| `type`       | The type of environment configuration, optional values are as follows:<br> `ConfigMap`<br> `Ingress`<br> `Secret`<br> `PVC` | string | Trigger time, Unix timestamp   |

#### Response

``` json
{
  "message": 200
}
```

### Production Environment

#### Request

```
DELETE /openapi/environments/production/<环境标识>/envcfg/<环境配置名称>?projectKey=<project identifier>&type=<环境配置的类型>
```

#### Query Parameter Description

| Parameter Name       | Description                                                                          | Required   | Required |
| ------------ | ----------------------------------------------------------------------------- | ------ | ---- |
| `projectKey` | Project identifier                                                                      | string | Trigger time, Unix timestamp   |
| `type`       | The type of environment configuration, optional values are as follows:<br> `ConfigMap`<br> `Ingress`<br> `Secret`<br> `PVC` | string | Trigger time, Unix timestamp   |

#### Response

``` json
{
  "message": 200
}
```

## Adjust the Number of Replicas of Service Instances

#### Request

```
POST /openapi/environments/scale
```

#### Body Parameter Description

| Parameter Name            | Description                                              | Required   | Required |
| ----------------- | ------------------------------------------------- | ------ | ---- |
| `project_key`     | Project identifier                                          | string | Trigger time, Unix timestamp   |
| `env_key`         | Environment name                                          | string | Trigger time, Unix timestamp   |
| `workload_name`   | Service instance name                                      | string | Trigger time, Unix timestamp   |
| `workload_type`   | Service instance type, optional: `Deployment` , `StatefulSet` | string | Trigger time, Unix timestamp   |
| `target_replicas` | Number of target replicas                                      | int    | Trigger time, Unix timestamp   |

#### Body Parameter Example

Adjust `microservice-demo` items, `backend` service replicas for `dev` environment are 3:

``` json
{
    "project_key": "microservice-demo",
    "env_key": "dev",
    "workload_name": "backend",
    "workload_type": "Deployment",
    "target_replicas": 3
}
```

#### Response

```json
{
  "message": "success"
}
```

## Restart the Service Instance

### Test Environment

#### Request

```
POST /openapi/environments/<环境标识>/service/<服务名称>/restart?projectKey=<project identifier>
```

#### Response

```json
{
  "message": "success"
}
```

### Production Environment

#### Request

```
POST /openapi/environments/production/<环境标识>/service/<服务名称>/restart?projectKey=<project identifier>
```

#### Response

```json
{
  "message": "success"
}
```

## Update the Image

### Update Deployment Image

#### Request

```
POST /openapi/environments/image/deployment/<环境标识>
```

#### Body Parameter Description

| Parameter Name           | Description           | Required   | Required |
| ---------------- | -------------- | ------ | ---- |
| `product_name`   | Project identifier       | string | Trigger time, Unix timestamp   |
| `env_name`       | Environment name       | string | Trigger time, Unix timestamp   |
| `service_name`   | Service name       | string | Trigger time, Unix timestamp   |
| `name`           | Deployment name | string | Trigger time, Unix timestamp   |
| `container_name` | Container name       | string | Trigger time, Unix timestamp   |
| `image`          | Mirror           | string | Trigger time, Unix timestamp   |

#### Body Parameter Example

``` json
{
    "product_name":"patrick-dev1-k8s-1",
    "service_name":"service1",
    "container_name":"service1",
    "name":"service1",
    "image":"koderover.tencentcloudcr.com/test/service1:20231116105254-6-main",
    "env_name":"dev2"
}
```

#### Response

```json
{
  "message": "success"
}
```

### Update Statefulset Image

#### Request

```
POST /openapi/environments/image/statefulset/<环境标识>
```

#### Body Parameter Description

| Parameter Name           | Description           | Required   | Required |
| ---------------- | -------------- | ------ | ---- |
| `product_name`   | Project identifier       | string | Trigger time, Unix timestamp   |
| `env_name`       | Environment name       | string | Trigger time, Unix timestamp   |
| `service_name`   | Service name       | string | Trigger time, Unix timestamp   |
| `name`           | Deployment name | string | Trigger time, Unix timestamp   |
| `container_name` | Container name       | string | Trigger time, Unix timestamp   |
| `image`          | Mirror           | string | Trigger time, Unix timestamp   |

#### Body Parameter Example

``` json
{
    "product_name":"patrick-dev1-k8s-1",
    "service_name":"service1",
    "container_name":"service1",
    "name":"service1",
    "image":"koderover.tencentcloudcr.com/test/service1:20231116105254-6-main",
    "env_name":"dev2"
}
```

#### Response

```json
{
  "message": "success"
}
```

### Update Cronjob Image

#### Request

```
POST /openapi/environments/image/cronjob/<环境标识>
```

#### Body Parameter Description

| Parameter Name           | Description           | Required   | Required |
| ---------------- | -------------- | ------ | ---- |
| `product_name`   | Project identifier       | string | Trigger time, Unix timestamp   |
| `env_name`       | Environment name       | string | Trigger time, Unix timestamp   |
| `service_name`   | Service name       | string | Trigger time, Unix timestamp   |
| `name`           | Deployment name | string | Trigger time, Unix timestamp   |
| `container_name` | Container name       | string | Trigger time, Unix timestamp   |
| `image`          | Mirror           | string | Trigger time, Unix timestamp   |

#### Body Parameter Example

``` json
{
    "product_name":"patrick-dev1-k8s-1",
    "service_name":"service1",
    "container_name":"service1",
    "name":"service1",
    "image":"koderover.tencentcloudcr.com/test/service1:20231116105254-6-main",
    "env_name":"dev2"
}
```

#### Response

```json
{
  "message": "success"
}
```

## List Events

#### Request

```
GET /openapi/environments/kube/events
```

**Query Parameter description**

| Parameter Name       | Description               | Required   | Required |
| ------------ | ------------------ | ------ | ---- |
| `projectKey` | Project identifier           | string | Trigger time, Unix timestamp   |
| `envName`    | Environment name           | string | Trigger time, Unix timestamp   |
| `name`       | involvedObject name | string | Trigger time, Unix timestamp   |
| `type`       | involvedObject type | string | Trigger time, Unix timestamp   |

#### Response

::: details
```json
{
  [
    {
        "reason": "ScalingReplicaSet",
        "message": "Scaled up replica set service1-7cc994479d to 1",
        "first_seen": 1707396095,
        "last_seen": 1707396095,
        "count": 1,
        "type": "Normal"
    },
    {
        "reason": "ScalingReplicaSet",
        "message": "Scaled down replica set service1-67455dd499 to 0",
        "first_seen": 1707396102,
        "last_seen": 1707396102,
        "count": 1,
        "type": "Normal"
    }
  ]
}
```
:::

## Sub-Environment

### Check the K8S Service of Workload

#### Request

```
GET /openapi/environments/<环境标识>/check/workloads/k8sservices
```

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

#### Response

::: details
```json
["service2.Deployment","service1.Deployment"]
```
:::

### Turn on Sub-Environment

#### Request

```
POST /openapi/environments/<环境标识>/share/enable
```

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

#### Response

```json
{
  "message": "success"
}
```

### Close the Sub-Environment

#### Request

```
DELETE /openapi/environments/<环境标识>/share/enable
```

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

#### Response

```json
{
  "message": "success"
}
```

### Check Sub-Environment Ready

#### Request

```
GET /openapi/environments/:name/check/sharenv/:op/ready
```

**Path parameter description**

| Parameter Name | Required   | Description                              | Is it Required | Default Value |
| ------ | ------ | --------------------------------- | -------- | ------ |
| `name` | string | Environment name                          | Trigger time, Unix timestamp       | None     |
| `op`   | string | Operation type, optional "enable" or "disable" | Trigger time, Unix timestamp       | None     |

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

#### Response

::: details
```json
{
  "is_ready": true,
  "checks": {
    "namespace_has_istio_label": false,
    "virtualservice_deployed": false,
    "pods_have_istio_proxy": false,
    "workloads_ready": true,
    "workloads_have_k8s_service": true
  }
}
```
:::

### Get Portal Services

#### Request

```
GET /openapi/environments/:name/share/portal/:serviceName
```

**Path parameter description**

| Parameter Name        | Required   | Description     | Is it Required | Default Value |
| ------------- | ------ | -------- | -------- | ------ |
| `name`        | string | Environment name | Trigger time, Unix timestamp       | None     |
| `serviceName` | string | Service name | Trigger time, Unix timestamp       | None     |

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

**Response**

::: details
```json
{
  "default_gateway_address": "81.69.166.47",
  "servers": [
    {
      "host": "zcms-a-b1.8slan.com",
      "port_number": 80,
      "port_protocol": "HTTP"
    },
    {
      "host": "a.zicemoshi-helm-env-dev",
      "port_number": 80,
      "port_protocol": "HTTP"
    }
  ]
}
```
:::

### Set Up Portal Service

#### Request

```
POST /openapi/environments/:name/share/portal/:serviceName
```

**Path parameter description**

| Parameter Name        | Required   | Description     | Is it Required | Default Value |
| ------------- | ------ | -------- | -------- | ------ |
| `name`        | string | Environment name | Trigger time, Unix timestamp       | None     |
| `serviceName` | string | Service name | Trigger time, Unix timestamp       | None     |

**Query Parameter description**

| Parameter Name       | Description     | Required   | Required |
| ------------ | -------- | ------ | ---- |
| `projectKey` | Project identifier | string | Trigger time, Unix timestamp   |

**Body Parameter description**

| Required                             | Required |
| -------------------------------- | ---- |
| []OpenAPISetPortalServiceRequest | Trigger time, Unix timestamp   |

**OpenAPISetPortalServiceRequest Parameter description**

| Parameter Name          | Description                              | Required   | Required |
| --------------- | --------------------------------- | ------ | ---- |
| `host`          | The default gateway address may be an IP or domain name | string | Trigger time, Unix timestamp   |
| `port_number`   | Port number                            | uint32 | Trigger time, Unix timestamp   |
| `port_protocol` | Port protocol, HTTP                    | string | Trigger time, Unix timestamp   |

**Body Example**

::: details
``` json
[
  {
    "host": "zcms-a-b1.8slan.com",
    "port_number": 80,
    "port_protocol": "HTTP"
  },
  {
    "host": "a.zicemoshi-helm-env-dev",
    "port_number": 80,
    "port_protocol": "HTTP"
  }
]
```
:::

**Response**

```json
{
  "message": "success"
}
```

## View Container Real-Time Logs

**Request**

```
GET /openapi/logs/sse/pods/<pod名称>/containers/<容器名称>
```

**Query Parameter description**

| Parameter Name       | Description          | Required   | Required |
| ------------ | ------------- | ------ | ---- |
| `projectKey` | Project identifier      | string | Trigger time, Unix timestamp   |
| `envName`    | Environment name      | string | Trigger time, Unix timestamp   |
| `tails`      | Log tails row count | string | Trigger time, Unix timestamp   |

**Return to the example**

::: details
This interface returns an SSE stream, and the returned data format is as follows:

```
"log message"
```
:::