---
title: Code scanning
date: 2023-04-18 16:03:41
permalink: /en/Zadig v3.4/api/scan/
---

## Create a Code Scan

**Request**

```
POST /openapi/quality/codescan
```

**body Parameter description**

|Parameter Name|Description|Required|Required|
|----------------|-------------------|---|---|
|`project_key`  |Project identifier|string|Trigger time, Unix timestamp|
|`name` |Code scan name| string|Trigger time, Unix timestamp|
|`description` |Introduction to code scanning| string|No|
|`scanner_type` |Code scanning tools have the following two scanning tools: `sonarQube` and `other`| string|Trigger time, Unix timestamp|
|`image_name` |The image name of the scan environment| string|Trigger time, Unix timestamp|
|`sonar_system` |SonarQube system identification| string|`scanner_type` = `sonarQube` required|
|`repo_info` |Codebase information| [][RepoInfo](#RepoInfo)|Trigger time, Unix timestamp|
|`addons` |Relying on software package information, just fill in the empty array if you don't need it.| [][AddOn](#AddOn)|Trigger time, Unix timestamp|
|`sonar_parameter` |Code scanning script| string|No|
|`script` |Code scanning script| string|No|
|`enable_quality_gate` |Whether to enable quality access control inspection| bool|Trigger time, Unix timestamp|
|`advanced_settings` |Advanced Configuration| [AdvancedSettings](#AdvancedSettings)|Trigger time, Unix timestamp|

<h4 id="!">RepoInfo Parameter description</h4>

|Parameter Name|Description|Required|Required|
|---|---|---|---|
|`codehost_name`|Code source identification|string|Trigger time, Unix timestamp|
|`repo_namespace`|The namespace to which the code base belongs (organization/personal)|string|Trigger time, Unix timestamp|
|`repo_name`|Codebase name|string|Trigger time, Unix timestamp|
|`branch`|Branch information|string|Trigger time, Unix timestamp|

<h4 id="!">AddOn Parameter description</h4>

|Parameter Name|Description|Required|Required|
|---|---|---|---|
|`name`|Package name|string|Trigger time, Unix timestamp|
|`version`|Package Version|string|Trigger time, Unix timestamp|


<h4 id="!">AdvancedSettings Parameter description</h4>

|Parameter Name|Description|Required|Required|
|---|---|---|---|
|`cluster_name`|Cluster name in resource configuration|string|Trigger time, Unix timestamp|
|`timeout`|Timeout in policy configuration|int|Trigger time, Unix timestamp|
|`resource_spec`|Resource Configuration|[ResourceSpec](#ResourceSpec)|Trigger time, Unix timestamp|
|`webhooks`|Trigger Configuration|[Webhooks](#Webhooks)|No|

<h4 id="!">ResourceSpec Parameter description</h4>

|Parameter Name|Description|Required|Required|
|---|---|---|---|
|`cpu_limit`| Maximum CPU resource, unit m|int|Trigger time, Unix timestamp|
|`memory_limit`|Maximum memory resource, unit Mi |int|Trigger time, Unix timestamp|
|`cpu_request`|Minimum CPU resource, unit m|int|Trigger time, Unix timestamp|
|`memory_request`|Minimum memory resource, unit Mi|int|Trigger time, Unix timestamp|

<h4 id="!">Webhooks Parameter description</h4>

|Parameter Name|Description|Required|Required|
|---|---|---|---|
|`enabled`| Whether to enable triggers|bool|Trigger time, Unix timestamp|
|`hook_list`|Trigger configuration details|[][Hook](#Hook)|`enabled` = `true` required|

<h4 id="!">Hook Parameter description</h4>

|Parameter Name|Description|Required|Required|
|---|---|---|---|
|`codehost_name`|Code source identification|string|Trigger time, Unix timestamp|
|`repo_namespace`|The namespace to which the code base belongs (organization/personal)|string|Trigger time, Unix timestamp|
|`repo_name`| Codebase name|string|Trigger time, Unix timestamp|
|`branch`| Target branch information|string|Trigger time, Unix timestamp|
|`events`| Trigger event type, optional: `push` , `pull_request` , `tag`|[]string|Trigger time, Unix timestamp|
|`match_folders`| File Directory|[]string|Trigger time, Unix timestamp|

**body Parameter example**

``` json
{
    "project_key": "demo",
    "name": "codescan-demo",
    "description": "code scan demo description",
    "scanner_type": "sonarQube",
    "sonar_system": "my-sonar",
    "image_name": "sonar:v1",
    "repo_info": [
        {
            "codehost_name": "github-demo",
            "repo_namespace": "kr-test-org",
            "repo_name": "zadig",
            "branch": "main"
        }
    ],
    "sonar_parameter": "sonar.projectKey=zadig\nsonar.projectName=zadig\nsonar.sources=./cmd/aslan",
    "enable_quality_gate": true,
    "advanced_settings": {
      "cluster_name": "dev-cluster",
      "timeout": 60,
      "resource_spec": {
        "cpu_limit": 1000,
        "memory_limit": 1000,
        "cpu_request": 500,
        "memory_request": 500
      }
    }
}
```

**Response**

```json
{
  "message": "success"
}
```



## Execute Code Scanning Tasks

**Request**

```
POST /openapi/quality/codescan/:scanName/task?projectKey=<project identifier>
```

**Query Parameter description**

| Parameter Name       | Required   | Description     | Required |
| ------------ | ------ | -------- | ---- |
| `projectKey` | string | Project identifier | Trigger time, Unix timestamp   |

**Path parameter description**

| Parameter Name     | Required   | Description         | Required |
| ---------- | ------ | ------------ | ---- |
| `scanName` | string | Code scan name | Trigger time, Unix timestamp   |

**Body Parameter description**

| Parameter Name       | Description       | Required              | Required |
| ------------ | ---------- | ----------------- | ---- |
| `scan_repos` | Codebase information | [][Repo](#repo-1) | Trigger time, Unix timestamp   |

<h4 id="!">Repo Parameter description</h4>

| Parameter Name       | Description                                                         | Required   | Required |
| ------------ | ------------------------------------------------------------ | ------ | ---- |
| `branch`     | Branch name                                                       | string | Trigger time, Unix timestamp   |
| `repo_name`  | Codebase name                                                   | string | Trigger time, Unix timestamp   |
| `repo_owner` | Organization name/user name                                                | string | Trigger time, Unix timestamp   |
| `source`     | Supported code repository sources:<br> `github` , `gitlab` , `gerrit` , `codehub` , `gitee` , `gitee-enterprise` , `other` | string | Trigger time, Unix timestamp   |
| `prs`        | PR number list                                                    | []int  | No   |

**body Parameter example**

```json
{
    "scan_repos":[
       {
         "branch":"master",
         "repo_name":"voting-app",
         "repo_owner":"kr-test-org1",
         "source":"gitlab",
         "prs":[]
       }
    ]
}
```



**Return successfully**

| Parameter Name    | Required | Description            |
| --------- | ---- | --------------- |
| `task_id` | int  | Code scanning task ID |

```json
{
  "task_id": 27
}
```

**Failed to return**

```json
{
    "code": 500,
    "description": "mongo: no documents in result",
    "message": "Internal Error: "
}
```

## Get Code Scanning Task Details

**Request**

```
GET /openapi/quality/codescan/:scanName/task/:taskID?projectKey=<project identifier>
```

**Path parameter description**

| Parameter Name     | Required   | Description            | Required |
| ---------- | ------ | --------------- | ---- |
| `scanName` | string | Code scan name    | Trigger time, Unix timestamp   |
| `taskID`   | int    | Code scanning task ID | Trigger time, Unix timestamp   |

**Query Parameter description**

| Parameter Name       | Required   | Description     | Required |
| ------------ | ------ | -------- | ---- |
| `projectKey` | string | Project identifier | Trigger time, Unix timestamp   |

**Return successfully**

| Parameter Name        | Required              | Description             |
| ------------- | ----------------- | ---------------- |
| `scan_name`   | string            | Code scan name     |
| `creator`     | string            | Task Creator       |
| `create_time` | int               | Task creation time     |
| `end_time`    | int               | Task execution end time |
| `task_id`     | int               | Code scanning task ID  |
| `status`      | string            | Execution results         |
| `result_link` | string            | Execution results details link |
| `repo_info`   | [][Repo](#repo-2) | Codebase information       |

<h4 id="!">Repo Parameter description</h4>

| Parameter Name       | Description                                                         | Required   |
| ------------ | ------------------------------------------------------------ | ------ |
| `branch`     | Branch name                                                       | string |
| `repo_name`  | Codebase name                                                   | string |
| `repo_owner` | Organization name/user name                                                | string |
| `source`     | Supported code repository sources:<br> `github` , `gitlab` , `gerrit` , `codehub` , `gitee` , `gitee-enterprise` , `other` | string |

**Return to the example**

```json
{
    "scan_name": "test",
    "creator": "admin",
    "task_id": 10,
    "status": "running",
    "create_time": 1689898942,
    "end_time": 1689898944,
    "result_link": "http://124.23.**.196:9009",
    "repo_info": [
        {
            "repo_owner": "kr-test-org1",
            "source": "gitlab",
            "address": "https://gitlab.com",
            "branch": "main",
            "repo_name": "microservice-demo",
        }
    ]
}
```

**Failed to return**

```json
{
    "code": 500,
    "description": "mongo: no documents in result",
    "message": "Internal Error: "
}
```